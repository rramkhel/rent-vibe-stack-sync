<!-- Tab 3: Full Reference -->
<section class="section">
    <h2 class="section-title">Full Reference</h2>
    <p class="section-subtitle">Complete data for due diligence — property hierarchy, unit types, and transaction rules.</p>

    <!-- Sub-tab navigation -->
    <div class="sub-tabs">
        <div class="sub-tabs-inner">
            <button class="sub-tab active" data-subtab="ref-hierarchy">Property Hierarchy</button>
            <button class="sub-tab" data-subtab="ref-units">Unit Types</button>
            <button class="sub-tab" data-subtab="ref-transactions">Transaction Types</button>
            <button class="sub-tab" data-subtab="ref-mappings">Platform Mappings</button>
        </div>
    </div>

    <!-- Sub-tab 1: Property Hierarchy -->
    <div class="sub-panel active" id="ref-hierarchy">
        <!-- Controls bar -->
        <div style="display: flex; gap: 8px; margin-bottom: 16px;">
            <button class="tree-ctrl active" onclick="toggleAllTree(true)">Expand All</button>
            <button class="tree-ctrl" onclick="toggleAllTree(false)">Collapse All</button>
        </div>

        <div id="property-hierarchy-tree">
            <!-- Generated from TAXONOMY by initReferenceTree() -->
        </div>
    </div>

    <!-- Sub-tab 2: Unit Types -->
    <div class="sub-panel" id="ref-units">
        <!-- Self-sufficient Unit Types -->
        <div class="card mb-6">
            <div class="card-header">
                <div>
                    <div class="card-title">Self-Sufficient Unit Types</div>
                    <div class="card-subtitle">These work without a property type — the unit IS the listing</div>
                </div>
                <span class="badge badge-teal">Unit-First</span>
            </div>
            <div class="card-body">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Unit Type</th>
                            <th>Code</th>
                            <th>Implied Sector</th>
                            <th>Implied Property Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Apartment</strong></td>
                            <td><code>apartment</code></td>
                            <td>Residential</td>
                            <td>Apartment Building (when known)</td>
                            <td>Standard rental unit in a multi-unit building. Most common listing type.</td>
                        </tr>
                        <tr>
                            <td><strong>Basement</strong></td>
                            <td><code>basement</code></td>
                            <td>Residential</td>
                            <td>House (when known)</td>
                            <td>Below-grade unit, typically in a house. Very common in Canadian market.</td>
                        </tr>
                        <tr>
                            <td><strong>Room (Private)</strong></td>
                            <td><code>room_private</code></td>
                            <td>Residential</td>
                            <td>— (any)</td>
                            <td>Private room in a shared dwelling. Property type always optional.</td>
                        </tr>
                        <tr>
                            <td><strong>Room (Shared)</strong></td>
                            <td><code>room_shared</code></td>
                            <td>Residential</td>
                            <td>— (any)</td>
                            <td>Shared room in a shared dwelling. Property type always optional.</td>
                        </tr>
                        <tr>
                            <td><strong>Office Space</strong></td>
                            <td><code>office</code></td>
                            <td>Commercial</td>
                            <td>Office Building (when known)</td>
                            <td>Office unit — could be in a Class A tower or a co-working space.</td>
                        </tr>
                        <tr>
                            <td><strong>Parking</strong></td>
                            <td><code>parking</code></td>
                            <td>Commercial</td>
                            <td>Parking (when known)</td>
                            <td>Parking spot or space.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="inline-note">
            <strong>Why "self-sufficient"?</strong> These unit types carry enough meaning on their own that the building type is optional. When someone lists "a basement for rent," they rarely know or care whether it's in a detached house or a semi. When building info <em>is</em> known, it's stored as enrichment — nothing is lost.
        </div>

        <!-- Structure-dependent Unit Types - Validation Matrix -->
        <div class="card mt-6">
            <div class="card-header">
                <div>
                    <div class="card-title">Structure-Dependent Unit Types</div>
                    <div class="card-subtitle">These require a property type — the building defines the listing</div>
                </div>
                <span class="badge badge-amber">Structure-First</span>
            </div>
            <div class="card-body">
                <p class="mb-4" style="font-size: 13px; color: var(--gray-600);">
                    Structure-dependent unit types describe <em>what portion</em> of a building is being listed. They only make sense in context of a specific property type. Not every combination is valid — the matrix below shows which unit types apply to each subtype.
                </p>

                <div style="overflow-x: auto;">
                    <table class="data-table" style="font-size: 12px;">
                        <thead>
                            <tr>
                                <th style="min-width: 180px; white-space: nowrap;">Subtype</th>
                                <th style="white-space: nowrap;">Entire</th>
                                <th style="white-space: nowrap;">Main Fl</th>
                                <th style="white-space: nowrap;">Suite</th>
                                <th style="white-space: nowrap;">Bsmt</th>
                                <th style="white-space: nowrap;">Apt</th>
                                <th style="white-space: nowrap;">Room</th>
                                <th style="white-space: nowrap;">Office</th>
                                <th style="white-space: nowrap;">Parking</th>
                                <th style="white-space: nowrap;">Floor</th>
                                <th style="white-space: nowrap;">Spot</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- RESIDENTIAL -->
                            <tr style="background: var(--dim-sector-light);">
                                <td colspan="11" style="font-weight: 700; color: #6d28d9;">RESIDENTIAL</td>
                            </tr>
                            <!-- House -->
                            <tr style="background: var(--gray-50);">
                                <td colspan="11" style="font-weight: 600; color: var(--gray-800);">House</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Detached</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Mobile</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Cabin</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px; font-style: italic; color: var(--gray-500);">Other (House)</td>
                                <td colspan="10" style="font-style: italic; color: var(--gray-400); text-align: center;">any</td>
                            </tr>
                            <!-- Townhouse / Plex -->
                            <tr style="background: var(--gray-50);">
                                <td colspan="11" style="font-weight: 600; color: var(--gray-800);">Townhouse / Plex</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Semi-Detached</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Townhouse</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Duplex</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Triplex</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Fourplex</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Multiplex</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px; font-style: italic; color: var(--gray-500);">Other (T/Plex)</td>
                                <td colspan="10" style="font-style: italic; color: var(--gray-400); text-align: center;">any</td>
                            </tr>
                            <!-- Apartment Building -->
                            <tr style="background: var(--gray-50);">
                                <td colspan="11" style="font-weight: 600; color: var(--gray-800);">Apartment Building</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Low Rise</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Mid Rise</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">High Rise</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Walk-up</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px; font-style: italic; color: var(--gray-500);">Other (Apt Bldg)</td>
                                <td colspan="10" style="font-style: italic; color: var(--gray-400); text-align: center;">any</td>
                            </tr>
                            <!-- Other Residential -->
                            <tr style="background: var(--gray-50);">
                                <td colspan="11" style="font-weight: 600; color: var(--gray-800);">Other Residential</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Office</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Parking</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px; font-style: italic; color: var(--gray-500);">Other (Res)</td>
                                <td colspan="10" style="font-style: italic; color: var(--gray-400); text-align: center;">any</td>
                            </tr>

                            <!-- COMMERCIAL -->
                            <tr style="background: var(--dim-subtype-light);">
                                <td colspan="11" style="font-weight: 700; color: #c2410c;">COMMERCIAL</td>
                            </tr>
                            <!-- Office -->
                            <tr style="background: var(--gray-50);">
                                <td colspan="11" style="font-weight: 600; color: var(--gray-800);">Office</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Class A/B/C</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Co-working</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px; font-style: italic; color: var(--gray-500);">Other (Office)</td>
                                <td colspan="10" style="font-style: italic; color: var(--gray-400); text-align: center;">any</td>
                            </tr>
                            <!-- Retail -->
                            <tr style="background: var(--gray-50);">
                                <td colspan="11" style="font-weight: 600; color: var(--gray-800);">Retail</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Storefront</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Mall</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Strip Mall</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px; font-style: italic; color: var(--gray-500);">Other (Retail)</td>
                                <td colspan="10" style="font-style: italic; color: var(--gray-400); text-align: center;">any</td>
                            </tr>
                            <!-- Industrial -->
                            <tr style="background: var(--gray-50);">
                                <td colspan="11" style="font-weight: 600; color: var(--gray-800);">Industrial</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Warehouse</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Manufacturing</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Flex Space</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Storage</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px; font-style: italic; color: var(--gray-500);">Other (Industrial)</td>
                                <td colspan="10" style="font-style: italic; color: var(--gray-400); text-align: center;">any</td>
                            </tr>
                            <!-- Parking -->
                            <tr style="background: var(--gray-50);">
                                <td colspan="11" style="font-weight: 600; color: var(--gray-800);">Parking</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Garage</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Surface Lot</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px; font-style: italic; color: var(--gray-500);">Other (Parking)</td>
                                <td colspan="10" style="font-style: italic; color: var(--gray-400); text-align: center;">any</td>
                            </tr>

                            <!-- RECREATION -->
                            <tr style="background: var(--dim-structure-light);">
                                <td colspan="11" style="font-weight: 700; color: #92400e;">RECREATION</td>
                            </tr>
                            <!-- Hospitality -->
                            <tr style="background: var(--gray-50);">
                                <td colspan="11" style="font-weight: 600; color: var(--gray-800);">Hospitality</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Hotel/Motel/B&B/Inn</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px; font-style: italic; color: var(--gray-500);">Other (Hospitality)</td>
                                <td colspan="10" style="font-style: italic; color: var(--gray-400); text-align: center;">any</td>
                            </tr>
                            <!-- Leisure -->
                            <tr style="background: var(--gray-50);">
                                <td colspan="11" style="font-weight: 600; color: var(--gray-800);">Leisure</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Marina/Campground/Stable</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px; font-style: italic; color: var(--gray-500);">Other (Leisure)</td>
                                <td colspan="10" style="font-style: italic; color: var(--gray-400); text-align: center;">any</td>
                            </tr>

                            <!-- OTHER -->
                            <tr style="background: var(--gray-100);">
                                <td colspan="11" style="font-weight: 700; color: var(--gray-700);">OTHER</td>
                            </tr>
                            <!-- Land -->
                            <tr style="background: var(--gray-50);">
                                <td colspan="11" style="font-weight: 600; color: var(--gray-800);">Land</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Agricultural/Acreage/Vacant</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px; font-style: italic; color: var(--gray-500);">Other (Land)</td>
                                <td colspan="10" style="font-style: italic; color: var(--gray-400); text-align: center;">any</td>
                            </tr>
                            <!-- Specialty -->
                            <tr style="background: var(--gray-50);">
                                <td colspan="11" style="font-weight: 600; color: var(--gray-800);">Specialty</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">TBD</td>
                                <td colspan="10" style="font-style: italic; color: var(--gray-400); text-align: center;">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px; font-style: italic; color: var(--gray-500);">Other (Specialty)</td>
                                <td colspan="10" style="font-style: italic; color: var(--gray-400); text-align: center;">any</td>
                            </tr>
                            <!-- Other -->
                            <tr style="background: var(--gray-50);">
                                <td colspan="11" style="font-weight: 600; color: var(--gray-800);">Other</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px;">Subdivision</td>
                                <td style="color: var(--teal); font-weight: 600;">✓</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                                <td style="color: var(--gray-300);">—</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 24px; font-style: italic; color: var(--gray-500);">Other (Other)</td>
                                <td colspan="10" style="font-style: italic; color: var(--gray-400); text-align: center;">any</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="inline-note mt-6">
            <strong>"Other" catch-alls accept any unit type.</strong> Every property type has an "Other" subtype that serves as an escape hatch for unrecognized values from acquisitions or edge cases. These are intentionally permissive — validation tightens as values are properly classified.
        </div>
    </div>

    <!-- Sub-tab 3: Transaction Types -->
    <div class="sub-panel" id="ref-transactions">
        <div class="card">
            <div class="card-header">
                <div>
                    <div class="card-title">Transaction Type Validity</div>
                    <div class="card-subtitle">Which transactions are valid for each property type</div>
                </div>
            </div>
            <div class="card-body">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Property Type</th>
                            <th>Subtype / Unit</th>
                            <th style="text-align: center;">Rent</th>
                            <th style="text-align: center;">Sale</th>
                            <th style="text-align: center;">Lease</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Residential Structure-First -->
                        <tr class="table-section-header">
                            <td colspan="7"><strong>RESIDENTIAL (Structure-First)</strong></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>House</td>
                            <td>All subtypes</td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>Townhouse/Plex</td>
                            <td>All subtypes</td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>Apartment Bldg</td>
                            <td>All subtypes</td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td>Sale via condo ownership attr</td>
                        </tr>

                        <!-- Residential Unit-First -->
                        <tr class="table-section-header">
                            <td colspan="7"><strong>RESIDENTIAL (Unit-First)</strong></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>(any)</td>
                            <td>Apartment</td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>(any)</td>
                            <td>Basement</td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>(any)</td>
                            <td>Room</td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td></td>
                        </tr>

                        <!-- Commercial Structure-First -->
                        <tr class="table-section-header">
                            <td colspan="7"><strong>COMMERCIAL (Structure-First)</strong></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>Office</td>
                            <td>Class A/B/C</td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>Retail</td>
                            <td>All subtypes</td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>Industrial</td>
                            <td>Warehouse/Mfg/Flex/Storage</td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>Industrial</td>
                            <td>Construction/New Dev</td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td>Sale only (pre-sale)</td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>Parking</td>
                            <td>Garage/Surface</td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td></td>
                        </tr>

                        <!-- Commercial Unit-First -->
                        <tr class="table-section-header">
                            <td colspan="7"><strong>COMMERCIAL (Unit-First)</strong></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>(any)</td>
                            <td>Office</td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>Office</td>
                            <td>Co-working</td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>(any)</td>
                            <td>Parking</td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td></td>
                        </tr>

                        <!-- Recreation -->
                        <tr class="table-section-header">
                            <td colspan="7"><strong>RECREATION</strong></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>Hospitality</td>
                            <td>All subtypes</td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td>Sale/lease of property</td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>Leisure</td>
                            <td>Marina/Campground/Stable</td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td>Lease (spot)</td>
                        </tr>

                        <!-- Other -->
                        <tr class="table-section-header">
                            <td colspan="7"><strong>OTHER</strong></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>Land</td>
                            <td>All subtypes</td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td>Sale or lease</td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>Other</td>
                            <td>Subdivision</td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td style="text-align: center;"><span class="badge badge-green">Yes</span></td>
                            <td style="text-align: center;"><span class="badge badge-gray">No</span></td>
                            <td>Sale (development)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="inline-note">
            <strong>Rent vs Lease:</strong> "Rent" is month-to-month or short-term residential. "Lease" is a fixed-term commercial agreement. Residential properties don't use "lease" even though renters sign leases — the transaction type refers to the commercial/legal model, not the document.
        </div>
    </div>

    <!-- Sub-tab 4: Platform Mappings -->
    <div class="sub-panel" id="ref-mappings">
        <div class="card">
            <div class="card-header">
                <div>
                    <div class="card-title">Platform Mapping Rules</div>
                    <div class="card-subtitle">How canonical values translate to each platform's display vocabulary</div>
                </div>
                <span class="badge badge-gray">Coming Soon</span>
            </div>
            <div class="card-body">
                <p style="font-size: 13px; color: var(--gray-500); margin-bottom: 16px;">
                    Each platform has a mapping table that translates the canonical 6-dimension model into its own vocabulary. The same listing can display differently on BSTK, Rentals.ca, Spacelist, and MLS — without duplicating data.
                </p>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 16px;">
                    <div style="padding: 12px; border-radius: 8px; border: 1px solid var(--platform-enterprise); border-top: 3px solid var(--platform-enterprise); background: var(--platform-enterprise-light);">
                        <div style="font-size: 12px; font-weight: 600; color: var(--gray-800);">BSTK / RentSync</div>
                        <div style="font-size: 11px; color: var(--gray-500); margin-top: 2px;">Full taxonomy, all fields</div>
                    </div>
                    <div style="padding: 12px; border-radius: 8px; border: 1px solid var(--platform-ils); border-top: 3px solid var(--platform-ils); background: var(--platform-ils-light);">
                        <div style="font-size: 12px; font-weight: 600; color: var(--gray-800);">ILS Network</div>
                        <div style="font-size: 11px; color: var(--gray-500); margin-top: 2px;">Simplified, renter-friendly</div>
                    </div>
                    <div style="padding: 12px; border-radius: 8px; border: 1px solid var(--platform-commercial); border-top: 3px solid var(--platform-commercial); background: var(--platform-commercial-light);">
                        <div style="font-size: 12px; font-weight: 600; color: var(--gray-800);">Spacelist</div>
                        <div style="font-size: 11px; color: var(--gray-500); margin-top: 2px;">Commercial only</div>
                    </div>
                    <div style="padding: 12px; border-radius: 8px; border: 1px solid var(--platform-mls); border-top: 3px solid var(--platform-mls); background: var(--platform-mls-light);">
                        <div style="font-size: 12px; font-weight: 600; color: var(--gray-800);">MLS</div>
                        <div style="font-size: 11px; color: var(--gray-500); margin-top: 2px;">Inbound feed mapping</div>
                    </div>
                </div>
                <div class="inline-note">
                    <strong>Platform mappings are configuration, not code.</strong> When we acquire a new platform, we add a mapping table — we don't restructure the data model. The full mapping tables will be documented here once the taxonomy is finalized. For now, the Listing Builder tab (Tab 2) demonstrates live platform output for any classification.
                </div>
            </div>
        </div>
    </div>

    <!-- Spreadsheet link utility bar -->
    <div class="utility-bar mt-6">
        This page explains the system. For the full canonical data, validation rules, and platform mappings:
        <a href="#">Link to Google Sheet</a>
    </div>
</section>

<script>
// Transaction rules per property type
const TRANSACTION_RULES = {
    'house': ['rent', 'sale'],
    'townhouse_plex': ['rent', 'sale'],
    'apartment_bldg': ['rent'],
    'other_res': ['rent'],
    'office': ['rent', 'sale', 'lease'],
    'retail': ['sale', 'lease'],
    'industrial': ['sale', 'lease'],
    'parking_pty': ['lease'],
    'hospitality': ['sale', 'lease'],
    'leisure': ['lease'],
    'land': ['sale', 'lease'],
    'specialty': [],
    'other_other': ['sale']
};

// Unit types per subtype (simplified — "other" catch-alls accept any)
const UNIT_TYPE_RULES = {
    // House
    'detached': ['entire', 'main_floor', 'suite', 'basement', 'room'],
    'mobile': ['entire'],
    'cabin': ['entire'],
    // T/Plex
    'semi': ['entire', 'main_floor', 'suite', 'basement', 'room'],
    'townhouse': ['entire', 'main_floor', 'suite', 'basement', 'room'],
    'duplex': ['entire', 'main_floor', 'suite', 'basement', 'room'],
    'triplex': ['entire', 'main_floor', 'suite', 'basement', 'room'],
    'fourplex': ['entire', 'main_floor', 'suite', 'basement', 'room'],
    'multiplex': ['entire', 'main_floor', 'suite', 'basement', 'room'],
    // Apt Bldg
    'low_rise': ['suite', 'apartment', 'room'],
    'mid_rise': ['suite', 'apartment', 'room'],
    'high_rise': ['suite', 'apartment', 'room'],
    'walk_up': ['suite', 'apartment', 'room'],
    // Office
    'class_a': ['entire', 'office', 'floor'],
    'class_b': ['entire', 'office', 'floor'],
    'class_c': ['entire', 'office', 'floor'],
    'coworking': ['office', 'spot'],
    // Retail
    'storefront': ['entire', 'suite'],
    'mall': ['suite'],
    'strip_mall': ['suite'],
    // Industrial
    'warehouse': ['entire', 'floor'],
    'manufacturing': ['entire'],
    'flex': ['entire', 'suite', 'spot'],
    'storage': ['entire', 'suite'],
    // Parking
    'garage': ['entire', 'parking', 'floor', 'spot'],
    'surface_lot': ['entire', 'parking', 'spot'],
    // Hospitality
    'hotel': ['entire'],
    'motel': ['entire'],
    'bnb': ['entire'],
    'inn': ['entire'],
    // Leisure
    'marina': ['spot'],
    'campground': ['spot'],
    'stable': ['spot'],
    // Land
    'agricultural': ['entire'],
    'acreage': ['entire'],
    'vacant': ['entire'],
    // Other
    'subdivision': ['entire']
};

const UNIT_TYPE_LABELS = {
    'entire': 'Entire', 'main_floor': 'Main Fl', 'suite': 'Suite', 'basement': 'Bsmt',
    'apartment': 'Apt', 'room': 'Room', 'office': 'Office', 'parking': 'Parking',
    'floor': 'Floor', 'spot': 'Spot'
};

const TRANSACTION_LABELS = { 'rent': 'Rent', 'sale': 'Sale', 'lease': 'Lease' };

// Toggle tree node
function toggleTree(el) {
    const ch = el.nextElementSibling;
    if (!ch || !ch.classList.contains('tree-children')) return;
    el.classList.toggle('open');
    ch.classList.toggle('open');
}

// Expand/collapse all
function toggleAllTree(open) {
    document.querySelectorAll('#ref-hierarchy .tree-header').forEach(h => {
        const ch = h.nextElementSibling;
        if (!ch || !ch.classList.contains('tree-children')) return;
        if (open) { h.classList.add('open'); ch.classList.add('open'); }
        else { h.classList.remove('open'); ch.classList.remove('open'); }
    });
    // Update button states
    document.querySelectorAll('#ref-hierarchy .tree-ctrl').forEach(btn => {
        btn.classList.toggle('active', btn.textContent.includes(open ? 'Expand' : 'Collapse'));
    });
}

// Initialize reference tree and sub-tabs when this tab loads
(function() {
    function initReferenceTab() {
        initSubTabs();
        initReferenceTree();
    }

    function initSubTabs() {
        const btns = document.querySelectorAll('#reference .sub-tab');
        const panels = document.querySelectorAll('#reference .sub-panel');

        btns.forEach(btn => {
            btn.addEventListener('click', () => {
                const targetId = btn.dataset.subtab;

                btns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                panels.forEach(p => {
                    p.classList.toggle('active', p.id === targetId);
                });
            });
        });
    }

    function initReferenceTree() {
        const container = document.getElementById('property-hierarchy-tree');
        if (!container || typeof TAXONOMY === 'undefined') return;

        let html = '';

        for (const [sectorKey, sector] of Object.entries(TAXONOMY)) {
            // Sector node
            html += `<div class="tree-node">`;
            html += `<div class="tree-header open" onclick="toggleTree(this)">`;
            html += `<span class="tree-toggle">▶</span>`;
            html += `<span class="tree-sector-hdr ${sectorKey}">${sector.label}</span>`;
            html += `<span class="tree-code">${sectorKey}</span>`;
            html += `</div>`;
            html += `<div class="tree-children open">`;

            for (const [typeKey, type] of Object.entries(sector.types)) {
                // Property type node
                const transactions = TRANSACTION_RULES[typeKey] || [];
                html += `<div class="tree-node">`;
                html += `<div class="tree-header open" onclick="toggleTree(this)">`;
                html += `<span class="tree-toggle">▶</span>`;
                html += `<span class="tree-label">${type.label}</span>`;
                html += `<span class="tree-code">${typeKey}</span>`;
                html += `</div>`;
                html += `<div class="tree-children open">`;

                // Column headers
                html += `<div class="tree-col-headers">`;
                html += `<div>Subtype</div><div>Variants</div><div>Unit Types</div><div>Transactions</div>`;
                html += `</div>`;

                for (const [subtypeKey, subtype] of Object.entries(type.subtypes)) {
                    const isOther = subtypeKey.includes('other') || subtypeKey.includes('_other');
                    const variants = subtype.variants || [];
                    const unitTypes = UNIT_TYPE_RULES[subtypeKey] || [];

                    html += `<div class="tree-subtype-row">`;

                    // Subtype name + code + badges
                    html += `<div>`;
                    html += `<strong>${subtype.label}</strong> `;
                    html += `<span class="tree-code">${subtypeKey}</span>`;
                    if (isOther) html += ` <span class="badge-catchall">catch-all</span>`;
                    html += `</div>`;

                    // Variants
                    html += `<div>`;
                    if (isOther) {
                        html += `<span class="chip chip-any">Any</span>`;
                    } else if (variants.length > 0) {
                        variants.forEach(v => {
                            const label = (typeof VARIANT_LABELS !== 'undefined' && VARIANT_LABELS[v]) || v;
                            html += `<span class="chip chip-variant">${label}</span>`;
                        });
                    } else {
                        html += `<span style="color: var(--gray-300);">—</span>`;
                    }
                    html += `</div>`;

                    // Unit Types
                    html += `<div>`;
                    if (isOther) {
                        html += `<span class="chip chip-any">Any</span>`;
                    } else if (unitTypes.length > 0) {
                        unitTypes.forEach(u => {
                            const label = UNIT_TYPE_LABELS[u] || u;
                            html += `<span class="chip chip-unit">${label}</span>`;
                        });
                    } else {
                        html += `<span style="color: var(--gray-300);">—</span>`;
                    }
                    html += `</div>`;

                    // Transactions
                    html += `<div>`;
                    if (isOther) {
                        html += `<span class="chip chip-any">Any</span>`;
                    } else if (transactions.length > 0) {
                        transactions.forEach(t => {
                            const label = TRANSACTION_LABELS[t] || t;
                            html += `<span class="chip chip-transaction">${label}</span>`;
                        });
                    } else {
                        html += `<span style="color: var(--gray-300);">—</span>`;
                    }
                    html += `</div>`;

                    html += `</div>`; // end row
                }

                html += `</div></div>`; // end type children + node
            }

            html += `</div></div>`; // end sector children + node
        }

        container.innerHTML = html;
    }

    // Initialize when tab loads
    document.addEventListener('tabloaded', (e) => {
        if (e.target.id === 'reference') {
            initReferenceTab();
        }
    });

    // Also try immediately
    if (document.getElementById('property-hierarchy-tree')) {
        initReferenceTab();
    }
})();
</script>
